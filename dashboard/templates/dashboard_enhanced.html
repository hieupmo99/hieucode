<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hieucode Pipeline Control Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 32px;
            color: white;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            background: #1e293b;
            color: #94a3b8;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            border-color: #667eea;
            color: #e2e8f0;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #334155;
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .control-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-running { background: #10b981; animation: pulse 2s infinite; }
        .status-stopped { background: #ef4444; }
        .status-warning { background: #f59e0b; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .control-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-start {
            background: #10b981;
            color: white;
        }

        .btn-start:hover { background: #059669; }

        .btn-stop {
            background: #ef4444;
            color: white;
        }

        .btn-stop:hover { background: #dc2626; }

        .btn-restart {
            background: #f59e0b;
            color: white;
        }

        .btn-restart:hover { background: #d97706; }

        .btn-logs {
            background: #3b82f6;
            color: white;
        }

        .btn-logs:hover { background: #2563eb; }

        .control-info {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .info-label {
            color: #94a3b8;
        }

        .info-value {
            color: #e2e8f0;
            font-weight: 600;
        }

        .logs-viewer {
            background: #0f172a;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #334155;
            margin-top: 20px;
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .logs-title {
            font-size: 18px;
            font-weight: 600;
        }

        .logs-controls {
            display: flex;
            gap: 10px;
        }

        .logs-select {
            background: #1e293b;
            color: #e2e8f0;
            border: 1px solid #334155;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .logs-content {
            background: #000;
            color: #0f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #94a3b8;
            margin-top: 8px;
            font-size: 13px;
        }

        .articles-grid {
            display: grid;
            gap: 15px;
        }

        .article-card {
            background: #1e293b;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #334155;
            display: flex;
            gap: 15px;
        }

        .article-img {
            width: 120px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        .article-content {
            flex: 1;
        }

        .article-title {
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .article-link {
            color: #667eea;
            font-size: 12px;
            text-decoration: none;
        }

        .article-link:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            color: #94a3b8;
            padding: 40px;
        }

        .spinner {
            border: 3px solid #334155;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ Hieucode Pipeline Control Center</h1>
            <p>Real-time monitoring and control dashboard</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview')">üìä Overview</div>
            <div class="tab" onclick="switchTab('services')">‚öôÔ∏è Services Control</div>
            <div class="tab" onclick="switchTab('logs')">üìã Logs</div>
            <div class="tab" onclick="switchTab('articles')">üì∞ Articles</div>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-articles">--</div>
                    <div class="stat-label">Total Articles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="today-articles">--</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="week-articles">--</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="running-services">--</div>
                    <div class="stat-label">Services Running</div>
                </div>
            </div>

            <div class="control-grid">
                <div class="control-card">
                    <div class="control-title">üê≥ Docker Status</div>
                    <div id="docker-status" class="control-info">Loading...</div>
                </div>
                <div class="control-card">
                    <div class="control-title">üìä Kafka Cluster</div>
                    <div id="kafka-status" class="control-info">Loading...</div>
                </div>
                <div class="control-card">
                    <div class="control-title">‚ö° Spark Streaming</div>
                    <div id="spark-status" class="control-info">Loading...</div>
                </div>
                <div class="control-card">
                    <div class="control-title">üîÑ Airflow</div>
                    <div id="airflow-status" class="control-info">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Services Control Tab -->
        <div id="services" class="tab-content">
            <div id="alerts"></div>
            
            <div class="control-grid">
                <!-- Crawler Control -->
                <div class="control-card">
                    <div class="control-header">
                        <div class="control-title">
                            <span class="status-dot status-stopped" id="crawler-status-dot"></span>
                            üï∑Ô∏è Crawler
                        </div>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-start" onclick="startCrawler()">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-stop" onclick="stopCrawler()">‚èπÔ∏è Stop</button>
                        <button class="btn btn-logs" onclick="viewLogs('crawler')">üìã Logs</button>
                    </div>
                    <div class="control-info" id="crawler-info">
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="crawler-status">Checking...</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Chrome Instances:</span>
                            <span class="info-value" id="crawler-chrome">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Processes:</span>
                            <span class="info-value" id="crawler-processes">0</span>
                        </div>
                    </div>
                </div>

                <!-- Kafka Control -->
                <div class="control-card">
                    <div class="control-header">
                        <div class="control-title">
                            <span class="status-dot status-stopped" id="kafka-status-dot"></span>
                            üìä Kafka
                        </div>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-start" onclick="startService('kafka')">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-stop" onclick="stopService('kafka')">‚èπÔ∏è Stop</button>
                        <button class="btn btn-logs" onclick="viewLogs('kafka-1')">üìã Logs</button>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-start" onclick="startKafkaUI()" style="flex: 1;">‚ñ∂Ô∏è Start Kafka UI</button>
                        <button class="btn btn-start" onclick="openKafkaUI()" style="flex: 1;">üåê Open UI</button>
                    </div>
                    <div class="control-info" id="kafka-info">
                        <div class="info-row">
                            <span class="info-label">Brokers:</span>
                            <span class="info-value" id="kafka-brokers">0/3</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">UI Port:</span>
                            <span class="info-value">8080</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">UI Status:</span>
                            <span class="info-value" id="kafka-ui-status">Checking...</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Topics:</span>
                            <span class="info-value" id="kafka-topics">0</span>
                        </div>
                    </div>
                </div>

                <!-- Spark Control -->
                <div class="control-card">
                    <div class="control-header">
                        <div class="control-title">
                            <span class="status-dot status-stopped" id="spark-status-dot"></span>
                            ‚ö° Spark
                        </div>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-start" onclick="startService('spark')">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-stop" onclick="stopService('spark')">‚èπÔ∏è Stop</button>
                        <button class="btn btn-logs" onclick="viewLogs('spark')">üìã Logs</button>
                    </div>
                    <div class="control-info" id="spark-info">
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="spark-status-text">Stopped</span>
                        </div>
                    </div>
                </div>

                <!-- Airflow Control -->
                <div class="control-card">
                    <div class="control-header">
                        <div class="control-title">
                            <span class="status-dot status-stopped" id="airflow-status-dot"></span>
                            üîÑ Airflow
                        </div>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-start" onclick="startService('airflow')">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-stop" onclick="stopService('airflow')">‚èπÔ∏è Stop</button>
                        <button class="btn btn-logs" onclick="viewLogs('airflow-webserver')">üìã Logs</button>
                    </div>
                    <div class="control-actions">
                        <button class="btn btn-start" onclick="openAirflowUI()" style="flex: 1;">üåê Open Airflow UI</button>
                    </div>
                    <div class="control-info" id="airflow-info">
                        <div class="info-row">
                            <span class="info-label">Port:</span>
                            <span class="info-value">8081</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Containers:</span>
                            <span class="info-value" id="airflow-containers">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <div class="logs-viewer">
                <div class="logs-header">
                    <div class="logs-title">üìã Container Logs</div>
                    <div class="logs-controls">
                        <select class="logs-select" id="log-container" onchange="loadLogs()">
                            <option value="crawler">Crawler</option>
                            <option value="spark">Spark</option>
                            <option value="kafka-1">Kafka-1</option>
                            <option value="kafka-2">Kafka-2</option>
                            <option value="kafka-3">Kafka-3</option>
                            <option value="airflow-webserver">Airflow Webserver</option>
                            <option value="airflow-scheduler">Airflow Scheduler</option>
                        </select>
                        <button class="btn btn-logs" onclick="loadLogs()">üîÑ Refresh</button>
                        <button class="btn btn-logs" onclick="toggleAutoRefresh()">‚è±Ô∏è Auto-refresh: OFF</button>
                    </div>
                </div>
                <div class="logs-content" id="logs-output">
                    Select a container and click refresh to view logs...
                </div>
            </div>
        </div>

        <!-- Articles Tab -->
        <div id="articles" class="tab-content">
            <div class="articles-grid" id="articles-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading articles...
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshLogs = false;
        let logsInterval = null;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'logs') {
                loadLogs();
            } else if (tabName === 'articles') {
                loadArticles();
            }
        }

        // Show alert
        function showAlert(message, type = 'info') {
            const alertsDiv = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertsDiv.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        // Crawler control
        async function startCrawler() {
            try {
                const response = await fetch('/api/crawler/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                if (data.success) {
                    showAlert('Crawler started successfully!', 'success');
                    setTimeout(updateStatus, 2000);
                } else {
                    showAlert('Failed to start crawler: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
                console.error('Start crawler error:', error);
            }
        }

        async function stopCrawler() {
            try {
                const response = await fetch('/api/crawler/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                if (data.success) {
                    showAlert('Crawler stopped successfully!', 'success');
                    setTimeout(updateStatus, 2000);
                } else {
                    showAlert('Failed to stop crawler: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
                console.error('Stop crawler error:', error);
            }
        }

        // Open Airflow UI in system browser
        async function openAirflowUI() {
            try {
                const response = await fetch('/api/open-browser?url=http://localhost:8081');
                const data = await response.json();
                if (data.success) {
                    showAlert('‚úÖ Airflow UI opened in your browser! Login: admin/admin', 'success');
                } else {
                    showAlert('‚ùå Failed to open. URL: http://localhost:8081 (admin/admin)', 'error');
                    // Copy to clipboard
                    navigator.clipboard.writeText('http://localhost:8081');
                    showAlert('üìã URL copied to clipboard!', 'info');
                }
            } catch (error) {
                showAlert('‚ùå Error: ' + error.message, 'error');
                // Copy to clipboard as fallback
                navigator.clipboard.writeText('http://localhost:8081');
                showAlert('üìã URL copied to clipboard: http://localhost:8081 (admin/admin)', 'info');
            }
        }

        // Start Kafka UI
        async function startKafkaUI() {
            try {
                showAlert('Starting Kafka UI...', 'info');
                const response = await fetch('/api/service/start/kafka-ui', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await response.json();
                if (data.success) {
                    showAlert('Kafka UI started! Wait 5 seconds then open...', 'success');
                    setTimeout(updateStatus, 3000);
                } else {
                    showAlert('Failed to start Kafka UI: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }

        // Open Kafka UI in system browser
        async function openKafkaUI() {
            try {
                const response = await fetch('/api/open-browser?url=http://localhost:8080');
                const data = await response.json();
                if (data.success) {
                    showAlert('‚úÖ Kafka UI opened in your browser! Check your browser tabs.', 'success');
                } else {
                    showAlert('‚ùå Failed to open. URL: http://localhost:8080', 'error');
                    // Copy to clipboard
                    navigator.clipboard.writeText('http://localhost:8080');
                    showAlert('üìã URL copied to clipboard!', 'info');
                }
            } catch (error) {
                showAlert('‚ùå Error: ' + error.message, 'error');
                // Copy to clipboard as fallback
                navigator.clipboard.writeText('http://localhost:8080');
                showAlert('üìã URL copied to clipboard: http://localhost:8080', 'info');
            }
        }

        // Service control
        async function startService(service) {
            showAlert(`Starting ${service}...`, 'info');
            // You can implement this by calling docker-compose
        }

        async function stopService(service) {
            showAlert(`Stopping ${service}...`, 'info');
            // You can implement this by calling docker-compose
        }

        // Logs
        async function loadLogs() {
            const container = document.getElementById('log-container').value;
            const logsOutput = document.getElementById('logs-output');
            logsOutput.textContent = 'Loading logs...';

            try {
                const response = await fetch(`/api/logs/${container}`);
                const data = await response.json();
                if (data.success) {
                    logsOutput.textContent = data.logs || 'No logs available';
                } else {
                    logsOutput.textContent = 'Error loading logs: ' + data.error;
                }
            } catch (error) {
                logsOutput.textContent = 'Error: ' + error.message;
            }
        }

        function viewLogs(container) {
            document.getElementById('log-container').value = container;
            switchTab('logs');
            setTimeout(loadLogs, 100);
        }

        function toggleAutoRefresh() {
            autoRefreshLogs = !autoRefreshLogs;
            const btn = event.target;
            btn.textContent = autoRefreshLogs ? '‚è±Ô∏è Auto-refresh: ON' : '‚è±Ô∏è Auto-refresh: OFF';
            
            if (autoRefreshLogs) {
                logsInterval = setInterval(loadLogs, 5000);
            } else {
                clearInterval(logsInterval);
            }
        }

        // Update status
        async function updateStatus() {
            // Update crawler status
            try {
                const crawlerResp = await fetch('/api/crawler/status');
                const crawlerData = await crawlerResp.json();
                const crawlerDot = document.getElementById('crawler-status-dot');
                const crawlerStatus = document.getElementById('crawler-status');
                const crawlerChrome = document.getElementById('crawler-chrome');
                const crawlerProcesses = document.getElementById('crawler-processes');

                if (crawlerData.running) {
                    crawlerDot.className = 'status-dot status-running';
                    crawlerStatus.textContent = 'Running';
                    crawlerChrome.textContent = crawlerData.chrome_instances || 0;
                    crawlerProcesses.textContent = crawlerData.process_count || 0;
                } else {
                    crawlerDot.className = 'status-dot status-stopped';
                    crawlerStatus.textContent = 'Stopped';
                    crawlerChrome.textContent = '0';
                    crawlerProcesses.textContent = '0';
                }
            } catch (error) {
                console.error('Error updating crawler status:', error);
            }

            // Update Docker status
            try {
                const dockerResp = await fetch('/api/docker/status');
                const dockerData = await dockerResp.json();
                document.getElementById('running-services').textContent = dockerData.running || 0;

                // Update Docker overview card
                const dockerStatus = document.getElementById('docker-status');
                dockerStatus.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Total Containers:</span>
                        <span class="info-value">${dockerData.total || 0}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Running:</span>
                        <span class="info-value">${dockerData.running || 0}</span>
                    </div>
                `;

                // Update individual service status
                const containers = dockerData.containers || [];
                
                // Kafka
                const kafkaBrokers = containers.filter(c => c.name.includes('kafka')).length;
                document.getElementById('kafka-brokers').textContent = `${kafkaBrokers}/3`;
                const kafkaDot = document.getElementById('kafka-status-dot');
                kafkaDot.className = kafkaBrokers === 3 ? 'status-dot status-running' : 'status-dot status-stopped';
                
                // Update Kafka overview card
                const kafkaStatus = document.getElementById('kafka-status');
                kafkaStatus.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Brokers:</span>
                        <span class="info-value">${kafkaBrokers}/3</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value">${kafkaBrokers === 3 ? '‚úÖ Healthy' : '‚ùå Down'}</span>
                    </div>
                `;

                // Spark
                const sparkRunning = containers.some(c => c.name === 'spark' && c.state === 'running');
                const sparkDot = document.getElementById('spark-status-dot');
                sparkDot.className = sparkRunning ? 'status-dot status-running' : 'status-dot status-stopped';
                document.getElementById('spark-status-text').textContent = sparkRunning ? 'Running' : 'Stopped';
                
                // Update Spark overview card
                const sparkStatus = document.getElementById('spark-status');
                sparkStatus.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value">${sparkRunning ? '‚úÖ Running' : '‚ùå Stopped'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Streaming:</span>
                        <span class="info-value">${sparkRunning ? 'Active' : 'Inactive'}</span>
                    </div>
                `;

                // Airflow
                const airflowContainers = containers.filter(c => c.name.includes('airflow')).length;
                document.getElementById('airflow-containers').textContent = airflowContainers;
                const airflowDot = document.getElementById('airflow-status-dot');
                airflowDot.className = airflowContainers > 0 ? 'status-dot status-running' : 'status-dot status-stopped';
                
                // Update Airflow overview card
                const airflowStatus = document.getElementById('airflow-status');
                airflowStatus.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Containers:</span>
                        <span class="info-value">${airflowContainers}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value">${airflowContainers > 0 ? '‚úÖ Running' : '‚ùå Stopped'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">UI:</span>
                        <span class="info-value"><a href="http://localhost:8081" target="_blank" style="color: #667eea;">Open</a></span>
                    </div>
                `;

            } catch (error) {
                console.error('Error updating docker status:', error);
            }

            // Update Kafka status
            try {
                const kafkaResp = await fetch('/api/kafka/status');
                const kafkaData = await kafkaResp.json();
                document.getElementById('kafka-topics').textContent = kafkaData.topic_count || 0;
            } catch (error) {
                console.error('Error updating kafka status:', error);
            }

            // Update stats
            try {
                const statsResp = await fetch('/api/stats');
                const statsData = await statsResp.json();
                document.getElementById('total-articles').textContent = statsData.total || 0;
                document.getElementById('today-articles').textContent = statsData.today || 0;
                document.getElementById('week-articles').textContent = statsData.week || 0;
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Load articles
        async function loadArticles() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                const articlesList = document.getElementById('articles-list');
                
                if (data.recent && data.recent.length > 0) {
                    articlesList.innerHTML = data.recent.map(article => `
                        <div class="article-card">
                            <img src="${article.src}" alt="${article.title}" class="article-img" onerror="this.style.display='none'">
                            <div class="article-content">
                                <div class="article-title">${article.title}</div>
                                <a href="${article.link}" target="_blank" class="article-link">${article.link}</a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    articlesList.innerHTML = '<div class="loading">No articles found</div>';
                }
            } catch (error) {
                document.getElementById('articles-list').innerHTML = '<div class="loading">Error loading articles</div>';
            }
        }

        // Initialize
        updateStatus();
        setInterval(updateStatus, 5000); // Update every 5 seconds
    </script>
</body>
</html>
